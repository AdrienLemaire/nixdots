Research on Webcam and Audio Support for Dell XPS 13 Plus 9320 on NixOS (March 2025)
Introduction

The Dell XPS 13 Plus 9320 is a high-end laptop featuring Intel's 12th Gen Alder Lake processors. While it's a powerful machine, getting certain hardware components to work on Linux distributions like NixOS can be challenging due to the need for specific drivers and configurations. This document provides comprehensive research on resolving issues with the webcam and audio (including microphone) for this laptop model on NixOS, with a focus on the projected state in March 2025.

The webcam utilizes Intel's Image Processing Unit 6 (IPU6), which has historically lacked proper in-tree driver support in the Linux kernel. Audio is managed through Sound Open Firmware (SOF), which is generally well-supported but has had reported issues, particularly with the microphone.

This research compiles information from official documentation, community discussions, and technical articles to offer solutions and projections for March 2025.
Webcam Support
Current State

The webcam on the XPS 13 Plus 9320 relies on Intel's IPU6, a component that processes image data from the camera sensor. Historically, IPU6 has been problematic on Linux because the drivers were not included in the mainline kernel, requiring users to install out-of-tree drivers or use specific patches. However, in mid-2024, the IPU6 driver was upstreamed into the Linux kernel version 6.10 (https://www.phoronix.com/news/Intel-IPU6-Media-In-Linux-6.10). This means that kernels 6.10 and later include native support for IPU6, simplifying the process for users.

For NixOS, a Linux distribution that uses a declarative configuration system, enabling hardware support often involves specific modules. The hardware.ipu6 module is designed to enable IPU6/MIPI camera support (https://mynixos.com/nixpkgs/option/hardware.ipu6.enable).
Known Issues

Prior to kernel 6.10, users had to rely on out-of-tree drivers, which were often unstable or required manual compilation and installation. Even with the upstreamed driver, there might be specific configurations or firmware requirements that need to be addressed in NixOS to ensure full functionality.

A tracking issue in the NixOS/nixpkgs repository for Intel MIPI/IPU6 webcam support (https://github.com/NixOS/nixpkgs/issues/225743) indicates that while support is being worked on, it may not be fully resolved yet as of the last update.
Solutions and Workarounds

To get the webcam working on NixOS, follow these steps:

    Update to the latest NixOS unstable channel: This ensures you have the most recent kernel and packages, including necessary drivers and firmware.
    text

sudo nix-channel --add https://nixos.org/channels/nixos-unstable nixos-unstable
sudo nix-channel --update
sudo nixos-rebuild switch
Enable the hardware.ipu6 module: Add the following to your /etc/nixos/configuration.nix:
text

    hardware.ipu6 = {
      enable = true;
      platform = "ipu6ep";  # For Alder Lake-based systems
    };
    Then, rebuild your system with sudo nixos-rebuild switch.
    Verify the kernel version: After updating, check that your kernel is at least version 6.10 using uname -r. If it's older, you may need to manually set a newer kernel in your configuration.

Community configurations, such as a GitHub gist for NixOS on the XPS 13 Plus 9320 (https://gist.github.com/p-alik/6ed132ffad59de8fcbc4fb10b54d745e), confirm that enabling hardware.ipu6 with the correct platform is effective.
Future Projections for March 2025

By March 2025, it is reasonable to expect that NixOS unstable will include kernels significantly beyond 6.10, incorporating any patches or improvements made to the IPU6 driver. This should result in stable and reliable webcam support out of the box, with minimal configuration required. Users might still need to ensure that the hardware.ipu6 module is enabled, but major issues should be resolved.
Audio Support
Current State

Audio on the XPS 13 Plus 9320 is handled through Sound Open Firmware (SOF), an open-source audio DSP firmware and SDK. SOF is generally well-supported on Linux, and for many systems, audio works without issues on recent kernels. The ArchWiki page for the XPS 13 Plus 9320 (https://wiki.archlinux.org/title/Dell_XPS_13_Plus_%289320%29) confirms that audio functions with SOF, recommending specific kernel modules for early loading.

However, there have been reports of microphone issues, where the microphone either records white noise or does not work at all. This is documented in an open issue in the NixOS/nixpkgs repository (https://github.com/NixOS/nixpkgs/issues/294048), where users have tested various NixOS versions and kernels without consistent success.
Known Issues

The primary issue revolves around the microphone not functioning correctly, despite speakers working as expected. Users have reported trying different configurations, updating firmware, and adjusting settings in tools like alsamixer, but the problem persists for some.

Community discussions, such as on the NixOS Discourse (https://discourse.nixos.org/t/dell-xps-13-9320-microphone-not-working/40932/1), highlight similar experiences, with some users finding workarounds while others continue to face challenges.
Solutions and Workarounds

To address audio issues, particularly with the microphone, consider the following steps:

    Update to the latest NixOS unstable channel: As with the webcam, ensuring you have the latest packages and kernel is crucial.
    text

    sudo nixos-rebuild switch --upgrade
    Check audio settings: Use tools like pavucontrol (for PulseAudio) or pw-gtk (for PipeWire) to verify that the microphone is not muted and is set as the default input device. Adjust levels if necessary.
    Verify kernel modules: Although NixOS typically handles module loading automatically, you can check if necessary modules like snd_soc_rt715_sdca and snd_sof_pci_intel_tgl are loaded. However, this is usually not required.

If problems persist, refer to the ArchWiki for additional guidance, though note that NixOS configurations differ from Arch Linux.
Future Projections for March 2025

Given the active development of SOF and ongoing kernel updates, it is likely that by March 2025, any existing audio issues, especially with the microphone, will be resolved. NixOS's commitment to providing up-to-date packages means that users should have access to the latest fixes and improvements. While some basic troubleshooting might still be necessary, such as checking audio settings, major functionality should be intact.
Sources and References

    NixOS hardware.ipu6.enable - MyNixOS: Documentation for the hardware.ipu6 module.
    Intel IPU6 Driver Being Upstreamed In Linux 6.10 - Phoronix: Article on the upstreaming of the IPU6 driver.
    Tracking Issue: Intel MIPI/IPU6 webcam-support · Issue #225743 · NixOS/nixpkgs: GitHub issue tracking IPU6 support in NixOS.
    NixOS config on Dell XPS 13 Plus 9320 · GitHub: Community configuration example.
    Dell XPS 13 Plus (9320) - ArchWiki: Arch Linux documentation for the XPS 13 Plus 9320.
    Audio support for Dell XPS 13 (9320) · Issue #294048 · NixOS/nixpkgs: GitHub issue on audio support.
    Dell XPS 13 9320 microphone not working - NixOS Discourse: Community discussion on microphone issues.

Appendices
Configuration Snippets

Enabling IPU6 for webcam:
text
hardware.ipu6 = {
  enable = true;
  platform = "ipu6ep";
};

Updating to NixOS unstable:
text
sudo nix-channel --add https://nixos.org/channels/nixos-unstable nixos-unstable
sudo nix-channel --update
sudo nixos-rebuild switch
Troubleshooting Commands

    Check kernel version: uname -r
    Open PulseAudio volume control: pavucontrol
    Open PipeWire GTK interface: pw-gtk

Reporting Issues

If you encounter persistent problems, consider reporting them on the NixOS GitHub issue tracker or seeking help on the NixOS Discourse forum.
